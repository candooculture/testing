<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Customer Churn</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;600&display=swap" rel="stylesheet"/>
  <link href="clarity-style.css" rel="stylesheet"/>
</head>
<body>
  <h1>Customer Churn</h1>

  <div class="info-banner">
    <strong>We’ve pre-filled your industry averages to save you time.</strong><br/>
    These reflect common performance in your sector.<br/>
    <em>Have your own data?</em> Just update the fields to sharpen your results.
  </div>

  <form id="churn-form">
    <div class="form-group">
      <label for="industry">Industry:</label>
      <select name="industry" id="industry" required>
        <option value="">Select your industry</option>
        <option value="Agriculture / Farming">Agriculture / Farming</option>
        <option value="Construction">Construction</option>
        <option value="Education & Training">Education & Training</option>
        <option value="Finance & Insurance">Finance & Insurance</option>
        <option value="Government / Public Sector">Government / Public Sector</option>
        <option value="Healthcare">Healthcare</option>
        <option value="Hospitality">Hospitality</option>
        <option value="Integrated Services">Integrated Services</option>
        <option value="Logistics & Transport">Logistics & Transport</option>
        <option value="Manufacturing">Manufacturing</option>
        <option value="Media / Creative / Comms">Media / Creative / Comms</option>
        <option value="Non-Profit">Non-Profit</option>
        <option value="Professional Services">Professional Services</option>
        <option value="Real Estate & Property">Real Estate & Property</option>
        <option value="Retail">Retail</option>
        <option value="Technology / SaaS">Technology / SaaS</option>
        <option value="Utilities / Energy / Waste">Utilities / Energy / Waste</option>
      </select>
    </div>

    <div class="form-group">
      <label for="total_employees">Total Employees:</label>
      <input type="number" name="total_employees" id="total_employees" required />
    </div>

    <div class="form-group">
      <label for="avg_salary">Average Annual Salary (AUD):</label>
      <input type="number" name="avg_salary" id="avg_salary" required />
    </div>

    <div class="form-group">
      <label for="churn_rate">Current Customer Churn Rate (% per year):</label>
      <input type="number" name="churn_rate" id="churn_rate" required />
    </div>

    <div class="form-group">
      <label for="desired_improvement">Desired Churn Improvement (% reduction target):</label>
      <input type="number" name="desired_improvement" id="desired_improvement" required />
      <small>e.g., 5 = reduce churn from 10% to 5%</small>
    </div>

    <button type="submit">Calculate</button>
  </form>

  <div id="results"></div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("churn-form");
      const resultBox = document.getElementById("results");

      const inputs = document.querySelectorAll("input, select");
      inputs.forEach(input => {
        const key = input.name;
        if (!key) return;
        const stored = localStorage.getItem(key);
        if (stored) {
          input.value = stored;
          input.classList.add("prefilled");
        }

        input.addEventListener("input", () => {
          localStorage.setItem(key, input.value);
          input.classList.remove("prefilled");
        });
      });

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(form).entries());

        try {
          const response = await fetch("https://candoo-clarity.onrender.com/run-customer-churn", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
          });

          const result = await response.json();

          if (result.revenue_loss != null) {
            const totalLoss = result.revenue_loss + result.replacement_cost;
            const recoveryOpportunity = (result.potential_gain / totalLoss) * 100;

            resultBox.innerHTML = `
              <div class="result-block">
                <p><strong>💸 Total Annual Loss from Customer Churn:</strong> AUD ${totalLoss.toLocaleString()}</p>
                <p><strong>📉 Lost Revenue from Churned Customers:</strong> AUD ${result.revenue_loss.toLocaleString()}</p>
                <p><strong>🔁 Replacement Cost (CAC):</strong> AUD ${result.replacement_cost.toLocaleString()}</p>
                <p><strong>✅ Based on Your Inputs:</strong> ${data.desired_improvement}% reduction in churn</p>
                <p><strong>🎯 Projected Recovery:</strong> AUD ${result.potential_gain.toLocaleString()}</p>
                <p><strong>📈 Estimated Recovery Opportunity:</strong> ${recoveryOpportunity.toFixed(1)}% of total churn loss</p>
                <p><strong>📊 Benchmark Check:</strong> ${data.industry} industry – ${result.benchmark_message}</p>
                <p><strong>💬 Straight Talk:</strong> You’re leaking AUD ${totalLoss.toLocaleString()} every year through churn and acquisition costs.</p>
                <p>🚀 Even a small improvement delivers AUD ${result.potential_gain.toLocaleString()} straight to your bottom line.</p>
              </div>
            `;
          }
        } catch (err) {
          resultBox.innerText = "Error calculating churn impact. Please try again.";
        }
      });
    });
  </script>
</body>
</html>
