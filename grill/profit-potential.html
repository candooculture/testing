<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Profit Potential – Now vs Fixed vs Risk-Free</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="clarity-style.css">
<style>
  :root{
    --maxw:1120px; --pad:24px; --gap:12px; --radius:12px;
    --accent:#13dcff; --bg:#333;
  }

  /* base */
  body{
    background: var(--bg);
    margin: 0;
    padding: var(--pad);
    display: block !important;
    font-family:"DM Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:#e5e7eb;
  }

  .wrap{
    max-width: var(--maxw);
    width: 100%;
    margin: 0 !important;              /* centering handled by #pp flex */
    padding: 0 24px;                    /* gutters */
    box-sizing: border-box;
    display: block !important;
    float: none !important;
    position: static !important;
    transform: none !important;
  }

  h1,h2,h3{margin:0 0 12px;}
  h1,h2{color:var(--accent);}
  p{margin:0 0 8px; opacity:.9;}

  /* cards/tables on white */
  .card, table{
    background:#fff; color:#0b0c10;
    border:1px solid #e5e7eb; border-radius:var(--radius);
  }
  .card{padding:18px; margin-bottom:16px; box-shadow:0 1px 2px rgba(0,0,0,.03);}

  /* grid */
  .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:var(--gap);}
  .col-3{grid-column:span 3;} .col-4{grid-column:span 4;}
  .col-6{grid-column:span 6;} .col-12{grid-column:span 12;}

  /* forms */
  label{display:block; font-size:.95rem; margin-bottom:6px; color:#000;}
  input[type="number"],input[type="text"],input[type="email"]{
    width:100%; box-sizing:border-box; padding:10px 12px;
    border:1px solid #cfd4dc; border-radius:8px; font-size:1rem;
    background:#fff; color:#000;
  }
  input::placeholder{color:#6b7280; opacity:1;}
  input[type="checkbox"]{transform:translateY(2px); margin-right:8px;}
  .hint{font-size:.85rem; opacity:.7;}

  /* actions/buttons */
  .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:8px;}
  button{
    appearance:none; border:1px solid var(--accent); background:var(--accent);
    color:#000; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer;
    box-shadow:0 2px 5px rgba(19,220,255,.2); transition:transform .04s, box-shadow .2s;
  }
  button:hover{box-shadow:0 10px 20px rgba(19,220,255,.15);}
  button:active{transform:translateY(1px);}
  button.ghost{background:#fff; color:#000; border-color:#cfd4dc; box-shadow:none;}

  /* table */
  table{width:100%; border-collapse:collapse; margin-top:8px; overflow:hidden;}
  thead th{background:#f7fafc; font-weight:700; border-bottom:2px solid rgba(19,220,255,.45);}
  th,td{text-align:right; padding:10px 12px; border-bottom:1px solid #f0f1f3; font-variant-numeric:tabular-nums;}
  th:first-child,td:first-child{text-align:left;}
  tfoot td{font-weight:700; background:linear-gradient(90deg,#ecfeff,#f0fdf4);}

  .pos{color:#059669;} .neg{color:#b91c1c;}

  .logo{position:relative; margin-bottom:10px;}
  .logo a{display:inline-flex; align-items:center; gap:10px; text-decoration:none; color:inherit;}
  .logo-tag{font-size:.9rem; opacity:.8; text-decoration:underline;}

#pp{
  display:grid !important;
  place-items:start center !important;
  min-height:100dvh;
  width:100% !important;        /* <-- uncap width */
  max-width:none !important;     /* <-- override 900px clamp */
  margin:0 !important;           /* beat margin:auto */
  padding:var(--pad) !important; /* beat global padding */
  background:var(--bg);
}
#pp .wrap{
  width:min(1120px,calc(100vw - 48px));
  margin:0 !important;
  padding-inline:24px;
  box-sizing:border-box;
  position:static !important; left:auto !important; right:auto !important; transform:none !important;
  float:none !important; clear:both !important;
}
@media (max-width:860px){
  #pp .wrap{ width:calc(100vw - 32px); padding-inline:16px; }
}
</style>
</head>
<body id="pp" >
  <div class="wrap">
    <div class="logo">
      <a href="https://candooculture.com/">
        <img src="candoologo.png" alt="Candoo Logo" style="width:48px;height:auto;opacity:.9">
        <span class="logo-tag">Return Home</span>
      </a>
    </div>

    <h1>Profit Potential</h1>
    <p class="hint">Compare today’s profit to what it could be if you fix inefficiencies and/or eliminate risk (ORS).</p>

    <!-- Current Financials -->
    <div class="card">
      <h2>Current Financials</h2>
      <p class="hint">Enter what you know. If you only know Net Profit, you can put it below and leave Revenue/COGS/Opex blank.</p>
      <div class="grid" style="margin-top:8px;">
        <div class="col-4">
          <label for="revenue">Revenue (period)</label>
          <input type="number" id="revenue" step="0.01" placeholder="e.g. 5,000,000">
        </div>
        <div class="col-4">
          <label for="cogs">COGS</label>
          <input type="number" id="cogs" step="0.01" placeholder="e.g. 2,500,000">
        </div>
        <div class="col-4">
          <label for="opex">Operating Expenses (excl COGS)</label>
          <input type="number" id="opex" step="0.01" placeholder="e.g. 1,900,000">
        </div>
        <div class="col-4">
          <label for="grossNow">Gross Profit (auto)</label>
          <input type="number" id="grossNow" step="0.01" disabled>
        </div>
        <div class="col-4">
          <label for="netNow">Net Profit (auto if above filled, else enter)</label>
          <input type="number" id="netNow" step="0.01" placeholder="e.g. 600,000">
        </div>
        <div class="col-4">
          <label for="periodLabel">Period Label</label>
          <input type="text" id="periodLabel" placeholder="e.g. FY25, Q3, Project X">
        </div>
      </div>
    </div>

    <!-- Savings only -->
<div class="card" id="card-savings">
  <h2>Fixable Savings</h2>
  <p class="hint">If your calculators already produced $-savings, they may auto-fill. Otherwise, type them.</p>

  <div class="grid">
    <div class="col-4">
      <label for="payrollSavings">Payroll Waste — Savings</label>
      <input type="number" id="payrollSavings" placeholder="e.g. 120,000" inputmode="decimal">
    </div>

    <div class="col-4">
      <label for="churnSavings">Customer Churn — Recovery</label>
      <input type="number" id="churnSavings" placeholder="e.g. 250,000" inputmode="decimal">
    </div>

    <div class="col-4">
      <label for="workforceSavings">Workforce Productivity — Gain</label>
      <input type="number" id="workforceSavings" placeholder="e.g. 300,000" inputmode="decimal">
    </div>

    <div class="col-4">
      <label for="deepDiveSavings">Productivity Deep Dive — Gain</label>
      <input type="number" id="deepDiveSavings" placeholder="e.g. 90,000" inputmode="decimal">
    </div>

    <div class="col-4">
      <label for="leadershipSavings">Leadership Drag — Reduction</label>
      <input type="number" id="leadershipSavings" placeholder="e.g. 160,000" inputmode="decimal">
    </div>
  </div>

  <div class="actions" style="margin-top:12px">
    <label><input type="checkbox" id="applyFixes" checked> Apply “Fix Inefficiencies”</label>
  </div>
</div>

<!-- ORS + Tax (Optional) -->
<div class="card" id="card-ors">
  <h2>ORS Risk &amp; Tax <span class="hint">(optional)</span></h2>

  <div class="grid">
    <div class="col-6">
      <label for="orsRisk">ORS — EBITDA at Risk</label>
      <input type="number" id="orsRisk" placeholder="e.g. 800,000" inputmode="decimal">
      <p class="hint" style="margin-top:6px">
        EBITDA = your core operating profit before interest &amp; tax. It’s pre-tax; the table also shows
        the estimated after-tax net impact. (We auto-fill this from other modules if found — edit if needed.)
      </p>
    </div>

    <div class="col-3">
      <label for="taxRate">Tax rate (%)</label>
      <input type="number" id="taxRate" placeholder="e.g. 30" min="0" max="60" step="1">
      <p class="hint" style="margin-top:6px">Converts ORS (EBITDA) to net after tax.</p>
    </div>

    <div class="col-3">
      <label>&nbsp;</label>
      <div class="actions">
        <label><input type="checkbox" id="applyORS" checked> Eliminate ORS Risk</label>
      </div>
    </div>
  </div>
</div>

    <!-- Results -->
    <div class="card">
      <h2>Profit Comparison</h2>
      <table id="resultsTable" aria-describedby="summary">
        <thead>
          <tr>
            <th>Scenario</th>
            <th>Gross Profit</th>
            <th>Net Profit</th>
            <th>Δ vs Now</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Now</td>
            <td id="gpNowCell">–</td>
            <td id="npNowCell">–</td>
            <td>–</td>
          </tr>
          <tr>
            <td>Fix Inefficiencies</td>
            <td id="gpFixCell">–</td>
            <td id="npFixCell">–</td>
            <td id="npFixDelta">–</td>
          </tr>
          <tr>
            <td>Eliminate ORS Risk (EBITDA)</td>
            <td id="gpORSCell">–</td>
            <td id="npORSCell">–</td>
            <td id="npORSDelta">–</td>
          </tr>
          <tr>
            <td>Eliminate ORS risk → Net after tax</td>
            <td id="gpORSNetCell">–</td>
            <td id="npORSNetCell">–</td>
            <td id="npORSNetDelta">–</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td>Fix + ORS Eliminated (Net after tax)</td>
            <td id="gpBestCell">–</td>
            <td id="npBestCell">–</td>
            <td id="npBestDelta">–</td>
          </tr>
        </tfoot>
      </table>
      <p id="summary" class="hint" style="margin-top:8px;"></p>
    </div>

    <!-- Export -->
    <div class="card">
      <h3>Export Snapshot</h3>
      <div class="actions">
        <button id="copyJSON" class="ghost">Copy JSON</button>
      </div>
      <p class="hint">Copies inputs + results so you can paste into notes or email.</p>
    </div>
  </div>

  <script>
  // ---- Storage Keys we try to read ----
  const KEYMAP = {
    ors: [
      "ors_ebitda_at_risk", "ors-ebitda-risk", "orsTotalRisk",
      "ORS_EBITDA_AT_RISK", "ebitdaAtRisk" // extra alias
    ],
    savings: {
      payroll:   ["payroll-waste-savings","payrollSavings","payroll_waste_savings"],
      churn:     ["customer-churn-savings","churnSavings","customer_churn_savings"],
      workforce: ["workforce-productivity-savings","workforceSavings","workforce_productivity_savings"],
      deep:      ["productivity-deep-dive-savings","deepDiveSavings","productivity_deep_dive_savings"],
      leadership:["leadership-drag-savings","leadershipSavings","leadership_drag_savings"]
    }
  };

  function lsFirstNumber(keys){
    for (const k of keys){
      const raw = localStorage.getItem(k);
      if (!raw) continue;

      // try a plain number string (allow commas)
      const v = Number(String(raw).replace(/,/g,"").trim());
      if (!Number.isNaN(v)) return v;

      // try JSON with common fields
      try{
        const obj = JSON.parse(raw);
        const candidates = ["value","amount","total","ebitda_at_risk","ebitdaRisk","risk","savings","gain"];
        for (const c of candidates){
          if (obj && typeof obj === "object" && obj[c] != null){
            const n = Number(String(obj[c]).replace(/,/g,""));
            if (!Number.isNaN(n)) return n;
          }
        }
      }catch(_){}
    }
    return null;
  }

  function fmt(n){
    return (n==null || Number.isNaN(n))
      ? "–"
      : n.toLocaleString(undefined,{style:"currency",currency:"AUD",maximumFractionDigits:0});
  }

  function num(id){
    const el = document.getElementById(id);
    if (!el) return 0;
    const v = Number(String(el.value).replace(/,/g,"").trim());
    return Number.isFinite(v) ? v : 0;
  }

  function setVal(id, value){
    const el = document.getElementById(id);
    if (!el) return;
    el.value = value ?? "";
    try { localStorage.setItem(id, el.value); } catch {}
  }

  // Always overwrite Net/Gross when top-line inputs exist
  function computeNow(){
    const rev  = num("revenue");
    const cogs = num("cogs");
    const opex = num("opex");

    let gp = num("grossNow") || null;
    let np = num("netNow"); // may be user-entered if no top-line inputs

    if (rev || cogs || opex){
      gp = (rev || 0) - (cogs || 0);
      np = gp - (opex || 0);

      // write both every time (prevents stale values)
      setVal("grossNow", String(gp));
      setVal("netNow",   String(np));
    } else {
      if (gp == null) gp = 0;
      if (!Number.isFinite(np)) np = 0;
    }
    return { gpNow: gp ?? 0, npNow: np ?? 0 };
  }

  function totalSavings(){
    return num("payrollSavings") + num("churnSavings") + num("workforceSavings")
         + num("deepDiveSavings") + num("leadershipSavings");
  }

  function deltaBadge(delta){
    if (!Number.isFinite(delta)) return "–";
    const cls  = delta >= 0 ? "pos" : "neg";
    const sign = delta >= 0 ? "+" : "";
    return `<span class="${cls}">${sign}${fmt(delta)}</span>`;
  }

  function taxRate(){
    const t = Number(document.getElementById("taxRate")?.value || 0);
    return Math.min(1, Math.max(0, t/100));
  }

  function recalc(){
    const { gpNow, npNow } = computeNow();
    const fixes = totalSavings();
    const ors   = num("orsRisk");
    const useFixes = document.getElementById("applyFixes").checked;
    const useORS   = document.getElementById("applyORS").checked;

    // Now
    document.getElementById("gpNowCell").textContent = fmt(gpNow);
    document.getElementById("npNowCell").textContent = fmt(npNow);

    // Fixes only
    const npFix = npNow + (useFixes ? fixes : 0);
    document.getElementById("gpFixCell").textContent = fmt(gpNow);
    document.getElementById("npFixCell").textContent = fmt(npFix);
    document.getElementById("npFixDelta").innerHTML = deltaBadge(npFix - npNow);

    // ORS only (EBITDA)
    const npORS = npNow + (useORS ? ors : 0);
    document.getElementById("gpORSCell").textContent = fmt(gpNow);
    document.getElementById("npORSCell").textContent = fmt(npORS);
    document.getElementById("npORSDelta").innerHTML = deltaBadge(npORS - npNow);

    // ORS → Net after tax
    const orsAfterTax = (useORS ? ors * (1 - taxRate()) : 0);
    const npORSnet = npNow + orsAfterTax;
    document.getElementById("gpORSNetCell").textContent = fmt(gpNow);
    document.getElementById("npORSNetCell").textContent = fmt(npORSnet);
    document.getElementById("npORSNetDelta").innerHTML = deltaBadge(npORSnet - npNow);

    // Best uses after-tax ORS so it's Net apples-to-apples
    const npBest = npNow + (useFixes ? fixes : 0) + orsAfterTax;
    document.getElementById("gpBestCell").textContent = fmt(gpNow);
    document.getElementById("npBestCell").textContent = fmt(npBest);
    document.getElementById("npBestDelta").innerHTML = deltaBadge(npBest - npNow);

    const period = (document.getElementById("periodLabel").value || "this period");
    document.getElementById("summary").textContent =
      `In ${period}, fixing inefficiencies adds ${fmt(useFixes?fixes:0)}. ` +
      `Eliminating ORS adds ${fmt(useORS?ors:0)} at EBITDA, ≈ ${fmt(useORS?orsAfterTax:0)} to net after tax. ` +
      `Best-case Net becomes ${fmt(npBest)} (from ${fmt(npNow)}).`;
  }

  function preload(){
    const ids = ["revenue","cogs","opex","grossNow","netNow","periodLabel",
      "payrollSavings","churnSavings","workforceSavings","deepDiveSavings","leadershipSavings",
      "orsRisk","applyFixes","applyORS","taxRate"];

    for (const id of ids){
      const el = document.getElementById(id); if (!el) continue;
      const stored = localStorage.getItem(id);
      if (stored != null){
        if (el.type === "checkbox") el.checked = stored === "true";
        else el.value = stored;
      }
      el.addEventListener(el.type === "checkbox" ? "change" : "input", ()=>{
        localStorage.setItem(id, el.type === "checkbox" ? String(el.checked) : el.value);
      });
    }

    // Pull module values if our fields are empty
    if (!num("payrollSavings"))   { const v=lsFirstNumber(KEYMAP.savings.payroll);    if (v!=null) setVal("payrollSavings",v); }
    if (!num("churnSavings"))     { const v=lsFirstNumber(KEYMAP.savings.churn);      if (v!=null) setVal("churnSavings",v); }
    if (!num("workforceSavings")) { const v=lsFirstNumber(KEYMAP.savings.workforce);  if (v!=null) setVal("workforceSavings",v); }
    if (!num("deepDiveSavings"))  { const v=lsFirstNumber(KEYMAP.savings.deep);       if (v!=null) setVal("deepDiveSavings",v); }
    if (!num("leadershipSavings")){ const v=lsFirstNumber(KEYMAP.savings.leadership); if (v!=null) setVal("leadershipSavings",v); }
    if (!num("orsRisk"))          { const v=lsFirstNumber(KEYMAP.ors);                if (v!=null) setVal("orsRisk",v); }
  }

  function copyJSON(){
    const payload = {
      period: document.getElementById("periodLabel").value || null,
      inputs: {
        revenue: num("revenue"), cogs: num("cogs"), opex: num("opex"),
        grossNow: num("grossNow") || null, netNow: num("netNow")
      },
      savings: {
        payroll: num("payrollSavings"), churn: num("churnSavings"),
        workforce: num("workforceSavings"), deepDive: num("deepDiveSavings"),
        leadership: num("leadershipSavings"),
      },
      ors: { ebitdaAtRisk: num("orsRisk") },
      taxRatePct: Number(document.getElementById("taxRate")?.value || 0),
      scenarios: {
        applyFixes: document.getElementById("applyFixes").checked,
        applyORS: document.getElementById("applyORS").checked
      },
      results: {
        now:   { gross: document.getElementById("gpNowCell").textContent,  net: document.getElementById("npNowCell").textContent },
        fixes: { gross: document.getElementById("gpFixCell").textContent,  net: document.getElementById("npFixCell").textContent,   delta: document.getElementById("npFixDelta").innerText },
        ors:   { gross: document.getElementById("gpORSCell").textContent,  net: document.getElementById("npORSCell").textContent,   delta: document.getElementById("npORSDelta").innerText },
        orsNet:{ gross: document.getElementById("gpORSNetCell").textContent, net: document.getElementById("npORSNetCell").textContent, delta: document.getElementById("npORSNetDelta").innerText },
        best:  { gross: document.getElementById("gpBestCell").textContent, net: document.getElementById("npBestCell").textContent,   delta: document.getElementById("npBestDelta").innerText }
      }
    };
    const text = JSON.stringify(payload, null, 2);
    navigator.clipboard.writeText(text).then(
      ()=>alert("Copied results JSON to clipboard."),
      ()=>{
        const ta=document.createElement("textarea"); ta.value=text; document.body.appendChild(ta);
        ta.select(); document.execCommand("copy"); document.body.removeChild(ta);
        alert("Copied results JSON to clipboard.");
      }
    );
  }

  window.addEventListener("DOMContentLoaded", ()=>{
    preload();
    ["revenue","cogs","opex","netNow","payrollSavings","churnSavings","workforceSavings",
     "deepDiveSavings","leadershipSavings","orsRisk","applyFixes","applyORS","periodLabel","taxRate"]
      .forEach(id=>{
        const el=document.getElementById(id); if(!el) return;
        el.addEventListener(el.type==="checkbox"?"change":"input", recalc);
      });
    document.getElementById("recalc").addEventListener("click", recalc);
    document.getElementById("copyJSON").addEventListener("click", copyJSON);
    document.getElementById("clear").addEventListener("click", ()=>{
      const ids=["revenue","cogs","opex","grossNow","netNow","periodLabel",
        "payrollSavings","churnSavings","workforceSavings","deepDiveSavings","leadershipSavings",
        "orsRisk","applyFixes","applyORS","taxRate"];
      for (const id of ids){
        localStorage.removeItem(id);
        const el=document.getElementById(id); if(!el) continue;
        if (el.type==="checkbox") el.checked=(id==="applyFixes"||id==="applyORS");
        else el.value="";
      }
      recalc();
    });
    recalc();
  });

  // (Optional) react to other tabs saving values
  window.addEventListener("storage", ()=>{ recalc(); });
</script>
</body>
</html>
